<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì±—ë´‡ {{ bot_name }}ì™€ ëŒ€í™”í•˜ê¸°</title>
  <!-- êµ¬ê¸€ í°íŠ¸ ë“± ì™¸ë¶€ ë§í¬ -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR&display=swap" rel="stylesheet">

  <!-- ê³µí†µ CSS -->
  <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    body {
      font-family: 'IBM Plex Sans KR', sans-serif;
      background: #f7f7f7;
      display: flex;
      flex-direction: column;
      align-items: center; /* ì „ì²´ ìì‹ ìš”ì†Œ ì¤‘ì•™ ì •ë ¬ */
    }
    /* í—¤ë” ìŠ¤íƒ€ì¼ */
    .header {
      width: 100vw;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #e8dff5;
      padding: 10px 20px;
      box-sizing: border-box;
    }
    .header-left img {
      width: 40px;
      height: 40px;
      object-fit: cover;
      border-radius: 8px;
    }
    .header-center {
      flex: 1;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 600;
      color: #333;
    }
    .close-btn {
      font-size: 1.2rem;
      background: none;
      border: none;
      cursor: pointer;
      color: #333;
    }

    /* ì±„íŒ… ì˜ì—­ */
    .chat-area {
      width: 100%;
      max-width: 900px;
      height: 600px;
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
      position: relative;
      
      /* bot_id, bot_image_url ì •ë³´ë¥¼ data ì†ì„±ìœ¼ë¡œ ë„˜ê²¨ë‘ë©´
         JS íŒŒì¼ì—ì„œ ììœ ë¡­ê²Œ ì½ì–´ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
    }
    #chat-log {
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
      overflow-y: auto;
      margin-bottom: 10px;
      /* ë†’ì´ë¥¼ ë³„ë„ë¡œ ì§€ì •í•˜ì§€ ì•Šì•„ë„, ë¶€ëª¨(.chat-area)ì˜ ë†’ì´
         ë‚´ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ì°¨ì§€ë©ë‹ˆë‹¤. */
    }
    .message {
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 8px;
      word-break: break-all;
    }
    .message.user {
      background: #e6f7ff;
      text-align: right;
      color: #0056b3;
    }
    .message.bot {
      color: #333;
      word-break: break-all;
    }
    .bot-text {
      background: #f0f0f0;
      padding: 10px;
      border-radius: 8px;
      text-align: left;
    }
    .bot-big-img {
      display: block;
      width: 100%;
      max-width: 300px;
      height: auto;
      margin: 0 auto 8px;
      border-radius: 8px;
    }
    /* ì±„íŒ… ì…ë ¥ ì˜ì—­ */
    .chat-input-area {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .chat-input-area input[type="text"] {
      flex: 1;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
    }
    .chat-input-area button.send-btn {
      padding: 8px 16px;
      border: none;
      background: #9264d1;
      color: #fff;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .chat-input-area button.send-btn:hover {
      background: #9264d1;
    }
    /* ë¯¸ë””ì–´ ë²„íŠ¼: ì±„íŒ… ì…ë ¥ ì˜ì—­ ë°–, ì™¼ìª½ì— ì ˆëŒ€ ìœ„ì¹˜ */
    .media-buttons {
      position: absolute;
      left: -50px;  /* ì™¼ìª½ìœ¼ë¡œ íŠ€ì–´ë‚˜ì˜¤ë„ë¡ */
      bottom: 70px; /* ì±„íŒ… ì…ë ¥ ì˜ì—­ ìœ„ë¡œ ìœ„ì¹˜ ì¡°ì • (ê¸°ì¡´ 20pxì—ì„œ ë³€ê²½) */
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .media-buttons button {
      background: none;
      border: none;
      cursor: pointer;
    }
    .media-buttons button img {
      width: 30px;
      height: 30px;
    }

    /* Modal ê³µí†µ ìŠ¤íƒ€ì¼ */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
      background-color: #fff;
      margin: 2% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      max-width: 1000px;
      border-radius: 12px;
      position: relative;
    }
    .modal-content h2 {
      margin-top: 0;
      margin-bottom: 5px;
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: rgba(0,0,0,0.5);
    }
    /* ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ ê·¸ë¦¬ë“œ (4ì—´) */
    .image-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 20px;
    }
    .image-grid img {
      width: 100%;
      height: auto;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <!-- í—¤ë” -->
  <header class="header">
    <div class="header-left">
      <img src="{{ url_for('static', filename='images/club_logo.png') }}" alt="ë™ì•„ë¦¬ ë¡œê³ ">
    </div>
    <div class="header-center">
      {{ bot_name }}
    </div>
    <div class="header-right">
      <button class="close-btn" onclick="window.location.href='{{ url_for('index') }}'">x</button>
    </div>
  </header>
  
  <!-- ì±„íŒ… ì˜ì—­ (ë°ì´í„° ì†ì„±ì— bot_id ë“± ì „ë‹¬) -->
  <div class="chat-area" 
       data-bot-id="{{ bot_id }}"
       data-bot-image-url="{{ url_for('static', filename='images/laughing.png') }}">
       
    <div id="chat-log"></div>

    <!-- ì±„íŒ… ì…ë ¥ ì˜ì—­ -->
    <div class="chat-input-area">
      <input type="text" id="user-message" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" required>
      <button class="send-btn" id="send-btn">ì „ì†¡</button>
    </div>

    <!-- ë¯¸ë””ì–´ ë²„íŠ¼ -->
    <div class="media-buttons">
      <button id="imageBtn">
        <img src="{{ url_for('static', filename='images/image-icon.png') }}" alt="ê·¸ë¦¼">
      </button>
      <button id="videoBtn">
        <img src="{{ url_for('static', filename='images/video-icon.png') }}" alt="ì˜ìƒ">
      </button>
    </div>
  </div>
  
  <!-- Video Modal -->
  {% if bot_id == 1 %}
  <div id="videoModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" data-close-modal="videoModal">&times;</button>
      <h2>ì˜ìƒ ë³´ê¸°</h2>
      <video controls style="width:100%; border-radius:8px; margin-top: 20px;">
        <source src="{{ url_for('static', filename='videos/chatbot1/chatbot1-video.mp4') }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
  {% elif bot_id == 2 %}
  <div id="videoModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" data-close-modal="videoModal">&times;</button>
      <h2>ì˜ìƒ ë³´ê¸°</h2>
      <video controls style="width:100%; border-radius:8px; margin-top: 20px;">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
  {% elif bot_id == 3 %}
  <div id="videoModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" data-close-modal="videoModal">&times;</button>
      <h2>ì˜ìƒ ë³´ê¸°</h2>
      <video controls style="width:100%; border-radius:8px; margin-top: 20px;">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
  {% elif bot_id == 4 %}
  <div id="videoModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" data-close-modal="videoModal">&times;</button>
      <h2>ì˜ìƒ ë³´ê¸°</h2>
      <video controls style="width:100%; border-radius:8px; margin-top: 20px;">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>
  {% endif %}
  
  <!-- Image Gallery Modal -->
  {% if bot_id == 1 %}
  <div id="imageModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" data-close-modal="imageModal">&times;</button>
      <h2>ê·¸ë¦¼ ë³´ê¸°</h2>
      <div class="image-grid">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery1.png') }}" alt="Gallery 1">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery2.png') }}" alt="Gallery 2">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery3.png') }}" alt="Gallery 3">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery4.png') }}" alt="Gallery 4">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery5.png') }}" alt="Gallery 5">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery6.png') }}" alt="Gallery 6">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery7.png') }}" alt="Gallery 7">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery8.png') }}" alt="Gallery 8">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery9.png') }}" alt="Gallery 9">
        <img src="{{ url_for('static', filename='images/chatbot1/gallery10.png') }}" alt="Gallery 10">
      </div>
    </div>
  </div>
  {% elif bot_id == 2 %}
  <div id="imageModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" data-close-modal="imageModal">&times;</button>
      <h2>ê·¸ë¦¼ ë³´ê¸°</h2>
      <div class="image-grid">
        <!-- chatbot2ì˜ ì´ë¯¸ì§€ë“¤ -->
      </div>
    </div>
  </div>
  {% elif bot_id == 3 %}
  <div id="imageModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" data-close-modal="imageModal">&times;</button>
      <h2>ê·¸ë¦¼ ë³´ê¸°</h2>
      <div class="image-grid">
        <!-- chatbot3ì˜ ì´ë¯¸ì§€ë“¤ -->
      </div>
    </div>
  </div>
  {% elif bot_id == 4 %}
  <div id="imageModal" class="modal">
    <div class="modal-content">
      <button class="modal-close" data-close-modal="imageModal">&times;</button>
      <h2>ê·¸ë¦¼ ë³´ê¸°</h2>
      <div class="image-grid">
        <img src="{{ url_for('static', filename='images/chatbot4/photo1.png') }}" alt="Photo 1">
        <img src="{{ url_for('static', filename='images/chatbot4/photo2.png') }}" alt="Photo 2">
        <img src="{{ url_for('static', filename='images/chatbot4/photo3.png') }}" alt="Photo 3">
        <img src="{{ url_for('static', filename='images/chatbot4/photo4.png') }}" alt="Photo 4">
      </div>
    </div>
  </div>
  {% endif %}

  <script>
    // JS íŒŒì¼ì´ í•œ ë²ˆë§Œ ë¡œë“œë˜ë„ë¡ í™•ì¸
    if (!window.chatbotScriptLoaded) {
      window.chatbotScriptLoaded = true;
      
      // HTML ë°ì´í„° ì†ì„±ì—ì„œ bot_id ì½ê¸°
      const chatArea = document.querySelector('.chat-area');
      const botId = chatArea.dataset.botId || '1';
  
      // ë¡œë“œí•  JS íŒŒì¼ ê²°ì •
      let jsFileName = 'chatbot_default.js';
      if (botId === '1') {
        jsFileName = 'chatbot1.js';
      } else if (botId === '2') {
        jsFileName = 'chatbot2.js';
      } else if (botId === '3') {
        jsFileName = 'chatbot3.js';
      } else if (botId === '4') {
        jsFileName = 'chatbot4.js';
      }
  
      // <script> íƒœê·¸ ë™ì ìœ¼ë¡œ ìƒì„±
      const scriptTag = document.createElement('script');
      scriptTag.src = `/static/js/${jsFileName}`;
      document.body.appendChild(scriptTag);
    }
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const chatArea = document.querySelector('.chat-area');
      const botId = chatArea.dataset.botId;
      
      if (botId == 4) {
        // ì±„íŒ… ë¡œê·¸ ì˜ì—­ ì°¾ê¸°
        const chatLog = document.getElementById('chat-log');
        
        // í™˜ì˜ ë©”ì‹œì§€ ì¶”ê°€
        const msgDiv = document.createElement('div');
        msgDiv.className = 'message bot';
        msgDiv.innerHTML = `
          <div class="bot-content">
            <div class="bot-text">ì•ˆë…•í•˜ì„¸ìš” ì„ ë°°ë‹˜! (âœ¨ê¾¸ë²…) ì €, ì´ë²ˆì— ììœ¨ì „ê³µí•™ë¶€ë¡œ ì…í•™í•œ ìƒˆë‚´ê¸° ì´ì•Œë¡œì˜ˆìš”! ì–´ë””ì„œ ë§ì´ ë³¸ ê²ƒ ê°™ë‹¤êµ¬ìš”â€¦? í—¤í—¤, ì‚¬ì‹¤ í•™êµì— ì¢€ ì˜¤ë˜ ìˆì—ˆê±°ë“ ìš”. (ì†Œê·¼ì†Œê·¼) ì²˜ìŒì´ë¼ ëª¨ë¥´ëŠ” ê²ƒë„ ë§ê³ , ìº í¼ìŠ¤ë„ ë„ˆë¬´ ë„“ê³  ì‹ ê¸°í•´ì„œâ€¦ í˜¹ì‹œ ê´œì°®ìœ¼ì‹œë‹¤ë©´, ì„ ë°°ë‹˜ê»˜ ì´ê²ƒì €ê²ƒ ì—¬ì­¤ë´ë„ ë ê¹Œìš”?<br>
            ğŸ—º<strong>ìº í¼ìŠ¤ íˆ¬ì–´ë¶€í„° ì‹œì‘í•´ì„œ</strong><br>
            ğŸ“<strong>ìˆ˜ê°•ì‹ ì²­ ê³ ë¯¼ ìƒë‹´ì´ë‚˜</strong><br>
            ğŸ”–<strong>ì‹œí—˜ê¸°ê°„ ê¿€íŒ ì „ìˆ˜</strong><br>
            ì•„ë‹ˆë©´ ê·¸ëƒ¥ ìˆ˜ë‹¤ë„ ì¢‹ì•„ìš”!<br>
            ì˜¤ëŠ˜ë¶€í„° ì œâ€¦ ì„œê°• ìƒí™œ ìƒì¡´ ë©˜í† , í•´ì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš” ì„ ë°°ë‹˜? (ËŠáµ•Ë‹)à©­</div>
            <p>ğŸ’¡ ì±—ë´‡ ì‚¬ìš©ë²•</p>
            <ul>
              <li>/ìŠ¤í† ë¦¬: ì•Œë¡œìŠ¤ì˜ ëŒ€í•™ ìƒí™œì„ í•¨ê»˜ ì§„í–‰í•´ìš”!</li>
              <li>/ìƒíƒœ: ì§€ê¸ˆê¹Œì§€ì˜ ì„ íƒê³¼ ì „ê³µ ìŠ¤íƒ¯ì„ ë³¼ ìˆ˜ ìˆì–´ìš”</li>
              <li>/ë„ì›€ë§: ì‚¬ìš© ê°€ëŠ¥í•œ ëª…ë ¹ì–´ë“¤ì„ ì•ˆë‚´í•´ë“œë ¤ìš”</li>
              <li>/ì¢…ë£Œ: ì±—ë´‡ì„ ì¢…ë£Œí•´ìš”</li>
            </ul>
            <p style="color: #9264d1; font-weight: bold; margin-top: 15px; text-align: center; padding: 10px; border: 2px dashed #9264d1; border-radius: 8px;">
    ğŸ‘‰ <strong>"/ìŠ¤í† ë¦¬"</strong> ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ì—¬ ì•Œë¡œìŠ¤ì˜ ëŒ€í•™ ìƒí™œ ìŠ¤í† ë¦¬ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!
            </p>
          </div>
        `;
        chatLog.appendChild(msgDiv);
        
        // ì„œë²„ì— ìƒíƒœ ë™ê¸°í™” ìš”ì²­
        fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ bot_id: parseInt(botId), message: "/start" })
        });
      }
    });
  </script>
</body>
</html>
